<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏™‡∏ô‡∏™‡∏ô‡∏∏‡∏Å  ‡§∏‡•á‡§Ç‡§ü‡•á‡§Ç‡§∏ ‡§¨‡§ø‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§ó‡•á‡§Æ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --purple: #8e44ad;
            --yellow: #f1c40f;
            --white: #ffffff;
            --dark: #333;
            --light-gray: #ecf0f1;
            --green: #2ecc71;
            --red: #e74c3c;
        }

        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--purple), var(--yellow));
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--dark);
        }

        .game-container {
            background-color: var(--white);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 800px;
            text-align: center;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        h1 {
            color: var(--purple);
            font-size: 2.5em;
        }
        
        h2 {
            color: var(--purple);
            font-size: 1.8em;
        }

        p {
            font-size: 1.2em;
            line-height: 1.6;
        }

        .input-group {
            margin: 20px 0;
        }

        input[type="text"] {
            padding: 15px;
            font-size: 1.2em;
            font-family: 'Kanit', sans-serif;
            border-radius: 10px;
            border: 2px solid var(--light-gray);
            width: 60%;
            text-align: center;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--purple);
        }

        button {
            background-color: var(--purple);
            color: var(--white);
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            font-family: 'Kanit', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #732d91;
            transform: translateY(-2px);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: 10px;
        }
        
        .game-header div {
            font-size: 1.2em;
            font-weight: bold;
        }

        #timer {
            color: var(--red);
        }
        
        #score, #level-display {
            color: var(--purple);
        }

        #question-area, #answer-area {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            min-height: 80px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        #question-area {
            background-color: #f8f9fa;
            border: 2px dashed var(--light-gray);
        }
        
        #answer-area {
            background-color: #e8f6f3;
            border: 2px dashed var(--green);
        }

        .word-block {
            background-color: var(--yellow);
            color: var(--dark);
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.4em;
            cursor: grab;
            user-select: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .word-block:active {
            cursor: grabbing;
            transform: scale(1.1);
            background-color: #f39c12;
        }

        #feedback {
            margin-top: 20px;
            font-size: 1.5em;
            font-weight: bold;
            height: 40px;
        }
        
        .correct {
            color: var(--green);
        }

        .incorrect {
            color: var(--red);
        }
        
        .level-up-message {
            padding: 40px;
            background-color: #eaf2f8;
            border-radius: 15px;
            color: var(--purple);
        }

        #leaderboard {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }

        #leaderboard li {
            background-color: var(--light-gray);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 1.2em;
        }

        #leaderboard li:nth-child(1) {
            background-color: #ffd700; /* Gold */
            font-weight: bold;
        }
        #leaderboard li:nth-child(2) {
            background-color: #c0c0c0; /* Silver */
        }
        #leaderboard li:nth-child(3) {
            background-color: #cd7f32; /* Bronze */
        }
        
        .emoji {
            font-size: 1.5em;
        }
    </style>
</head>
<body>

    <div class="game-container">
        
        <div id="start-screen" class="screen active">
            <h1>‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ üöÄ</h1>
            <p>‡∏°‡∏≤‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
            </div>
            <button id="start-button">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
        </div>

        <div id="instructions-screen" class="screen">
            <h2>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° üìù</h2>
            <p>
                1. <strong>‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á:</strong> ‡∏•‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á<br>
                2. <strong>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:</strong> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö"<br>
                3. <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 60% ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏î‡πà‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ï‡πà‡∏≠<br>
                4. <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ‡∏ô‡πâ‡∏≠‡∏á‡πÜ ‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 10 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô ‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞! ‚è≥
            </p>
            <button id="begin-button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢!</button>
        </div>

        <div id="game-screen" class="screen">
            <div class="game-header">
                <div id="player-display">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: </div>
                <div id="level-display">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà: 1</div>
                <div id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</div>
                <div id="timer">‡πÄ‡∏ß‡∏•‡∏≤: 10:00</div>
            </div>
            
            <p><strong>‡∏•‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á üëá</strong></p>
            <div id="question-area"></div>
            <div id="answer-area"></div>
            
            <button id="submit-button">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‚úÖ</button>
            <div id="feedback"></div>
        </div>
        
        <div id="level-up-screen" class="screen">
            <div class="level-up-message">
                <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! üéâ</h2>
                <p id="level-up-text"></p>
                <button id="next-level-button">‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ!</button>
            </div>
        </div>


        <div id="game-over-screen" class="screen">
            <h2>‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß! üèÅ</h2>
            <p id="summary-text">‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å!</p>
            <h3>üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° üèÜ</h3>
            <ol id="leaderboard"></ol>
            <button id="play-again-button">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const startScreen = document.getElementById('start-screen');
            const instructionsScreen = document.getElementById('instructions-screen');
            const gameScreen = document.getElementById('game-screen');
            const levelUpScreen = document.getElementById('level-up-screen');
            const gameOverScreen = document.getElementById('game-over-screen');

            const playerNameInput = document.getElementById('player-name');
            const startButton = document.getElementById('start-button');
            const beginButton = document.getElementById('begin-button');
            const submitButton = document.getElementById('submit-button');
            const nextLevelButton = document.getElementById('next-level-button');
            const playAgainButton = document.getElementById('play-again-button');
            
            const playerDisplay = document.getElementById('player-display');
            const levelDisplay = document.getElementById('level-display');
            const scoreDisplay = document.getElementById('score');
            const timerDisplay = document.getElementById('timer');
            const questionArea = document.getElementById('question-area');
            const answerArea = document.getElementById('answer-area');
            const feedbackDisplay = document.getElementById('feedback');
            const levelUpText = document.getElementById('level-up-text');
            const summaryText = document.getElementById('summary-text');
            const leaderboardList = document.getElementById('leaderboard');
            
            // --- Game State ---
            let playerName = '';
            let score = 0;
            let currentLevel = 1;
            let timeRemaining = 600; // 10 minutes in seconds
            let timerInterval;
            let currentQuestion = null;
            let questionsAnsweredInLevel = 0;
            let correctAnswersInLevel = 0;
            let draggedItem = null;

            const questions = [
                // ‡∏£‡∏∞‡∏î‡∏±‡∏ö 1: ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô + ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ + ‡∏Å‡∏£‡∏£‡∏° (S+V+O)
                { level: 1, parts: ['‡∏â‡∏±‡∏ô', '‡∏Å‡∏¥‡∏ô', '‡∏Ç‡πâ‡∏≤‡∏ß'], correctAnswer: '‡∏â‡∏±‡∏ô‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß' },
                { level: 1, parts: ['‡πÅ‡∏°‡∏ß', '‡∏î‡∏∑‡πà‡∏°', '‡∏ô‡∏°'], correctAnswer: '‡πÅ‡∏°‡∏ß‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°' },
                // ‡∏£‡∏∞‡∏î‡∏±‡∏ö 2: ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô + ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ + ‡∏Å‡∏£‡∏£‡∏° + ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Å‡∏£‡∏£‡∏° (S+V+O+O.Mod)
                { level: 2, parts: ['‡∏û‡πà‡∏≠', '‡∏≠‡πà‡∏≤‡∏ô', '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡πÄ‡∏•‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà'], correctAnswer: '‡∏û‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà' },
                { level: 2, parts: ['‡πÅ‡∏°‡πà', '‡∏ã‡∏∑‡πâ‡∏≠', '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤', '‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°'], correctAnswer: '‡πÅ‡∏°‡πà‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°' },
                { level: 2, parts: ['‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤', '‡∏õ‡∏•‡∏π‡∏Å', '‡∏Ç‡πâ‡∏≤‡∏ß', '‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥'], correctAnswer: '‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤‡∏õ‡∏•‡∏π‡∏Å‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥' },
                // ‡∏£‡∏∞‡∏î‡∏±‡∏ö 3: ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô + ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ + ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ + ‡∏Å‡∏£‡∏£‡∏° (S+V+Adv+O)
                { level: 3, parts: ['‡∏û‡∏µ‡πà', '‡∏Ç‡∏µ‡πà', '‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô', '‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß'], correctAnswer: '‡∏û‡∏µ‡πà‡∏Ç‡∏µ‡πà‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß' },
                { level: 3, parts: ['‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π', '‡∏™‡∏≠‡∏ô', '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à'], correctAnswer: '‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à' },
                // ‡∏£‡∏∞‡∏î‡∏±‡∏ö 4: ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô + ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô + ‡∏Å‡∏£‡∏¥‡∏¢‡∏≤ + ‡∏Å‡∏£‡∏£‡∏° + ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Å‡∏£‡∏£‡∏° (S+S.Mod+V+O+O.Mod)
                { level: 4, parts: ['‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏ß', '‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô', '‡∏ß‡∏≤‡∏î', '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', '‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°'], correctAnswer: '‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°' },
                { level: 4, parts: ['‡∏™‡∏∏‡∏ô‡∏±‡∏Ç', '‡∏ï‡∏±‡∏ß‡∏≠‡πâ‡∏ß‡∏ô', '‡∏Å‡∏¥‡∏ô', '‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å', '‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà'], correctAnswer: '‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ï‡∏±‡∏ß‡∏≠‡πâ‡∏ß‡∏ô‡∏Å‡∏¥‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà' },
                { level: 4, parts: ['‡∏ô‡∏Å', '‡∏™‡∏µ‡∏ü‡πâ‡∏≤', '‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á', '‡πÑ‡∏û‡πÄ‡∏£‡∏≤‡∏∞'], correctAnswer: '‡∏ô‡∏Å‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏û‡πÄ‡∏£‡∏≤‡∏∞' }
            ];

            let availableQuestions = [...questions];

            const questionsPerLevel = {
                1: questions.filter(q => q.level === 1).length,
                2: questions.filter(q => q.level === 2).length,
                3: questions.filter(q => q.level === 3).length,
                4: questions.filter(q => q.level === 4).length,
            };
            
            // --- Functions ---
            const switchScreen = (screenId) => {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            };

            const startGame = () => {
                playerName = playerNameInput.value.trim();
                if (playerName === '') {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üòä');
                    return;
                }
                playerDisplay.textContent = `‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: ${playerName}`;
                switchScreen('instructions-screen');
            };

            const beginGame = () => {
                resetGame();
                switchScreen('game-screen');
                startTimer();
                loadNextQuestion();
            };

            const resetGame = () => {
                score = 0;
                currentLevel = 1;
                timeRemaining = 600;
                availableQuestions = [...questions];
                scoreDisplay.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0`;
                levelDisplay.textContent = `‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà: 1`;
                questionsAnsweredInLevel = 0;
                correctAnswersInLevel = 0;
                if(timerInterval) clearInterval(timerInterval);
            };

            const startTimer = () => {
                timerInterval = setInterval(() => {
                    timeRemaining--;
                    const minutes = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
                    const seconds = (timeRemaining % 60).toString().padStart(2, '0');
                    timerDisplay.textContent = `‡πÄ‡∏ß‡∏•‡∏≤: ${minutes}:${seconds}`;

                    if (timeRemaining <= 0) {
                        endGame('timeup');
                    }
                }, 1000);
            };

            const loadNextQuestion = () => {
                feedbackDisplay.textContent = '';
                feedbackDisplay.className = '';
                submitButton.disabled = false;
                
                let levelQuestions = availableQuestions.filter(q => q.level === currentLevel);

                if (levelQuestions.length === 0) {
                    handleLevelEnd();
                    return;
                }

                currentQuestion = levelQuestions[0];
                
                // Remove this question from the main pool
                availableQuestions = availableQuestions.filter(q => q !== currentQuestion);

                questionArea.innerHTML = '';
                answerArea.innerHTML = '';

                const shuffledParts = [...currentQuestion.parts].sort(() => Math.random() - 0.5);
                shuffledParts.forEach((part, index) => {
                    const wordBlock = document.createElement('div');
                    wordBlock.className = 'word-block';
                    wordBlock.textContent = part;
                    wordBlock.draggable = true;
                    wordBlock.id = `word-${index}`;
                    wordBlock.addEventListener('dragstart', dragStart);
                    questionArea.appendChild(wordBlock);
                });
            };

            const checkAnswer = () => {
                const wordsInAnswer = Array.from(answerArea.children).map(child => child.textContent);
                const userAnswer = wordsInAnswer.join('');

                if (userAnswer === currentQuestion.correctAnswer) {
                    score += 10;
                    correctAnswersInLevel++;
                    feedbackDisplay.textContent = '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö! üëç';
                    feedbackDisplay.className = 'correct';
                } else {
                    feedbackDisplay.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ô‡∏∞ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà! ü§î';
                    feedbackDisplay.className = 'incorrect';
                }
                
                scoreDisplay.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
                questionsAnsweredInLevel++;
                submitButton.disabled = true;

                setTimeout(() => {
                    if (questionsAnsweredInLevel >= questionsPerLevel[currentLevel]) {
                        handleLevelEnd();
                    } else {
                        loadNextQuestion();
                    }
                }, 1500);
            };
            
            const handleLevelEnd = () => {
                 const passPercentage = (correctAnswersInLevel / questionsPerLevel[currentLevel]) * 100;
                 
                 if (passPercentage >= 60) {
                     if (currentLevel < 4) {
                        currentLevel++;
                        levelUpText.textContent = `‡∏ô‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${currentLevel - 1} ‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏û‡∏ö‡∏Å‡∏±‡∏ö‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${currentLevel} ‡∏ó‡∏µ‡πà‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô!`;
                        switchScreen('level-up-screen');
                        // Reset level counters
                        questionsAnsweredInLevel = 0;
                        correctAnswersInLevel = 0;
                     } else {
                         endGame('completed');
                     }
                 } else {
                     endGame('failed_level');
                 }
            };
            
            const proceedToNextLevel = () => {
                levelDisplay.textContent = `‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${currentLevel}`;
                switchScreen('game-screen');
                loadNextQuestion();
            };

            const endGame = (reason) => {
                clearInterval(timerInterval);
                let message = '';
                switch(reason) {
                    case 'completed':
                        message = `üéâ ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å ${playerName}! ‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡∏ó‡∏∏‡∏Å‡∏î‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏¢ ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏õ ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏õ ${formatTime(600 - timeRemaining)}!`;
                        break;
                    case 'timeup':
                        message = `‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏ô‡∏∞ ${playerName} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡∏°‡πà! ‡∏ô‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
                        break;
                    case 'failed_level':
                        message = `‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞! ‡∏ô‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${currentLevel} ‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏π‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞! ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
                        break;
                }
                summaryText.textContent = message;
                updateLeaderboard();
                displayLeaderboard();
                switchScreen('game-over-screen');
            };

            const updateLeaderboard = () => {
                const leaderboard = JSON.parse(localStorage.getItem('sentenceGameLeaderboard')) || [];
                const timeTaken = 600 - timeRemaining;
                
                leaderboard.push({ name: playerName, score: score, time: timeTaken });

                leaderboard.sort((a, b) => {
                    if (b.score !== a.score) {
                        return b.score - a.score; // Higher score first
                    }
                    return a.time - b.time; // Lower time first
                });

                // Keep only top 10
                const top10 = leaderboard.slice(0, 10);
                localStorage.setItem('sentenceGameLeaderboard', JSON.stringify(top10));
            };

            const displayLeaderboard = () => {
                const leaderboard = JSON.parse(localStorage.getItem('sentenceGameLeaderboard')) || [];
                leaderboardList.innerHTML = '';
                if (leaderboard.length === 0) {
                    leaderboardList.innerHTML = '<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢ ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏™‡∏¥!</li>';
                    return;
                }
                leaderboard.forEach((entry, index) => {
                    const li = document.createElement('li');
                    let medal = '';
                    if (index === 0) medal = 'ü•á';
                    if (index === 1) medal = 'ü•à';
                    if (index === 2) medal = 'ü•â';
                    
                    li.innerHTML = `<span>${medal} ${index + 1}. ${entry.name}</span> <span>${entry.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (${formatTime(entry.time)})</span>`;
                    leaderboardList.appendChild(li);
                });
            };
            
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins} ‡∏ô‡∏≤‡∏ó‡∏µ ${secs} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
            };


            // --- Drag and Drop Handlers ---
            function dragStart(e) {
                draggedItem = e.target;
                setTimeout(() => {
                    e.target.style.display = 'none';
                }, 0);
            }

            function dragOver(e) {
                e.preventDefault();
            }

            function drop(e) {
                e.preventDefault();
                if (e.target.id === 'answer-area' || e.target.id === 'question-area') {
                    draggedItem.style.display = 'block';
                    e.target.appendChild(draggedItem);
                    draggedItem = null;
                }
            }


            // --- Event Listeners ---
            startButton.addEventListener('click', startGame);
            beginButton.addEventListener('click', beginGame);
            submitButton.addEventListener('click', checkAnswer);
            nextLevelButton.addEventListener('click', proceedToNextLevel);
            playAgainButton.addEventListener('click', () => switchScreen('start-screen'));

            questionArea.addEventListener('dragover', dragOver);
            questionArea.addEventListener('drop', drop);
            answerArea.addEventListener('dragover', dragOver);
            answerArea.addEventListener('drop', drop);
        });
    </script>
</body>
</html>
